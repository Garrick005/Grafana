# Домашнее задание к занятию «Микросервисы: принципы»

## Задача 1: API Gateway

Для реализации API Gateway Kong будет  по следующим причинам:

- Гибкость маршрутизации и поддержка различных типов API (REST, GraphQL, gRPC).
- Широкая поддержка аутентификации через стандартные механизмы (JWT, OAuth2), что упрощает интеграцию с другими сервисами.
- Поддержка терминации HTTPS с возможностью автоматической генерации сертификатов через Let's Encrypt.
- Хорошая масштабируемость с поддержкой кластеризации и интеграции с контейнерами и Kubernetes.
- Простота в управлении конфигурациями через веб-UI и REST API, что делает его удобным для эксплуатации в продакшн-средах.

Вывод: маршрутизатор Kong способен принимать на себя не только задачи умной маршрутизации, но и имеет возможности по протоколированию и трансформации запросов, контролю доступа, мониторингу запросов, а также может быть расширен с использованием плагинов.

## Задача 2: Брокер сообщений

| Критерий / Возможность                                                         | Pulsar                                                                                                                                                                                                                                           | Kafka                                                                                                                                                                                                        | RabbitMQ                                                                                                                                                                 | ActiveMQ                                                                                                                                                                                          | RocketMQ                                                                                                                                                                        |
| ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Кластеризация / отказоустойчивость / масштабирование                           | Да — горизонтальное масштабирование, брокеры + отдельный слой хранения (BookKeeper), автоматический ребалансинг при добавлении/удалении нод. Поддержка multi-тенантности, namespaces, ролей, разграничения доступа.                       | Да — распределённые брокеры, партиции, репликация, устойчивый “commit log”. Хорошая масштабируемость и throughput для больших объёмов.                                                                    | Частичная: RabbitMQ поддерживает кластеризацию и зеркалирование очередей (mirrored / quorum queues) для отказоустойчивости.                                             | Да — ActiveMQ поддерживает “Network of Brokers”, репликацию, кластеризацию, различные варианты персистентности (файловая система, БД) для устойчивого хранения.                               | Да — RocketMQ — распределённый брокер / потоковая шина, рассчитан на масштабируемость и высокую производительность.                                          |
| Хранение сообщений на диск / персистентность при доставке                      | Да — Pulsar пишет в BookKeeper, гарантируется запись на диск (fsync), обеспечивая надёжность при сбоях.                                                                                                                | Да — Kafka хранит сообщения в виде неизменяемого commit-лога на диске, с репликацией.                                                                                                                   | Да — RabbitMQ поддерживает персистентные очереди; но при высокой нагрузке зеркалирование/кворумные очереди дают капельку снижения производительности.                | Да — ActiveMQ предлагает варианты с file- или кэшем + файл + БД для хранения, гарантируя персистентность.                                                                                     | Да — RocketMQ хранит сообщения (commit log или файловое хранилище), поддерживает устойчивую доставку.                                                     |
| Высокая скорость / высокая пропускная способность / масштабируемость           | Да — Pulsar оптимизирован для низкой задержки + очень высокой нагрузки; масштабирование за счёт разделения брокеров и storage-слоя.                                                                                   | Да — Kafka изначально ориентирован на очень высокую пропускную способность и масштабирование потоков.                                                                                                   | Средняя/умеренная — RabbitMQ хорошо подходит для умеренных нагрузок, real-time очередей, но при “миллионах сообщений/сек” масштабирование сложнее.                       | Средняя/умеренная — ActiveMQ подходит для корпоративных нагрузок, но на «ультра-высоких» (big data, сотни тысяч/миллионов msg/s) может уступать решениям типа Kafka/Pulsar.                      | Да — RocketMQ заявляет о “низкой задержке, высокой производительности, масштабируемости” и подходит для сценариев с большим объёмом сообщений.                |
| Поддержка различных форматов / схем сообщений / гибкости форматов              | Да — Pulsar имеет встроенный Schema Registry, поддерживает валидацию форматов, версионирование схем, удобно для структурированных данных.                                                                              | Да — Kafka “просто хранит байты”; пользователи могут использовать JSON, Avro, Protobuf и пр., реализовывая свой формат.                                                                                     | Да, в целом — RabbitMQ поддерживает разные протоколы и форматы (зависит от клиента и обработки), особенно с AMQP.                                                       | Да — ActiveMQ поддерживает JMS, разные протоколы, гибок в типах сообщений, форматах, маршрутизации.                                                                                              | Да — RocketMQ позволяет произвольные “payload” сообщений, поддерживает разные типы сообщений: обычные, задержанные, последовательные, транзакционные и пр. |
| Разделение прав доступа / безопасность / разграничение пользователей / потоков | Да — Pulsar имеет встроенную multi-tenant архитектуру: tenants, namespaces, темы; есть fine-grained ACL, права на публикацию/подписку на уровне namespace или topic.                                                 | Нет «из коробки» такого гибкого многоарендного ACL; Kafka рассчитан на доверенное окружение либо требует внешние решения. (в целом: управление доступом обычно на уровне сети, ACL дополнительных надстроек) | Есть базовые возможности — очереди, пользователи, permissions по очередям; но переключение между tenants/namespace может быть сложнее, особенно в больших системах.     | Есть возможности аутентификации и персистентности, но в сложных сценариях мульти-тенантности / тонкого ACL — менее гибок, чем более “новые” системы.                                             | Да — у RocketMQ есть поддержка ACL: можно настроить разрешения по topic (PUB / SUB / DENY), по consumer-group, белые списки IP, учетные ключи.            |
| Простота эксплуатации / администрирования (ops, масштабирование, обслуживание) | Хорошо, но архитектура несколько сложнее из-за разделения storage и брокеров, BookKeeper, metadata (ZooKeeper). Требуется чуть больше навыков и понимания.                                                      | Относительно просто на старте, зрелая экосистема, много операционных гайдов, но при крупном кластере — partitioning, репликации, управление offset / retention / баланс — требует опыта.                  | Один из самых простых для старта брокеров, богатая экосистема клиентов и протоколов, удобно для небольших/средних систем.                                           | Более сложная Java / enterprise среда, требует больше конфигураций, но привычна для организаций на Java                                                                                      | Требует настройки кластера, NameServer, брокеров, конфигураций — не “минимум усилий”, но вполне рабочий промышленный вариант.                                                |

Наиболее подходящим вариантом является Apache Pulsar по следующим причинам:

- Кластерная архитектура + устойчивость: Pulsar спроектирован как распределённая система с чётким разделением брокеров и слоя хранения (BookKeeper). Это даёт надёжность, отказоустойчивость, возможность горизонтального масштабирования и лёгкое добавление/удаление нод без простоев. 
- Гарантированная персистентность: сообщения записываются на диск (fsync) через BookKeeper, что обеспечивает, что сообщения не потеряются при сбое узла. 
- Высокая производительность и масштабируемость: архитектура, разделяющая хранение и брокеров, позволяет добиться высокой пропускной способности и низкой задержки, даже при большом количестве тем, подписчиков и высокой нагрузке. 
- Гибкость форматов и схем: встроенный Schema Registry позволяет задавать форматы, версии схем сообщений, валидацию — удобно, если у вас структурированные данные и нужна эволюция схем. 
- Разграничение доступа и мультиарендность: Pulsar изначально поддерживает multi-tenant, namespaces, темы; настраиваются права (produce/consume) на уровне namespace или topic, что позволяет изолировать потоки, распределять права между командами, сервисами и т.п. 
- Относительно приемлемая операционная сложность: хотя Pulsar — не “минималистичный” брокер, его архитектура даёт преимущества при масштабировании, и управление (CLI / REST) + поддержка облачных / container / Kubernetes-сред делают его вполне эксплуатабельным. 
- Кроме того, Pulsar совмещает возможности традиционных очередей (queueing) и потоковых систем (streaming / pub-sub), что даёт гибкость, если со временем требования к системе меняются. 
